<!DOCTYPE html>
<html lang="zh-tw"><head>
  <meta charset="utf-8">
  <title>學習筆記</title>

  <!-- mobile responsive meta -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="練習專案五：大疫世代">
  <meta name="author" content="Steve">
    
  
  <meta name="theme-name" content="liva-hugo" />
  
  <meta name="generator" content="Hugo 0.140.2">

  <!-- plugins -->
  
  <link rel="stylesheet" href="https://ho291ey992.github.io/plugins/bootstrap/bootstrap.min.css ">
  
  <link rel="stylesheet" href="https://ho291ey992.github.io/plugins/slick/slick.css ">
  
  <link rel="stylesheet" href="https://ho291ey992.github.io/plugins/themify-icons/themify-icons.css ">
  
  <link rel="stylesheet" href="https://ho291ey992.github.io/plugins/venobox/venobox.css ">
  

  <!-- Main Stylesheet -->
  
  <link rel="stylesheet" href="https://ho291ey992.github.io/scss/style.min.css" media="screen">

  <!--Favicon-->
  <link rel="shortcut icon" href="https://ho291ey992.github.io/images/favicon.png " type="image/x-icon">
  <link rel="icon" href="https://ho291ey992.github.io/images/favicon.png " type="image/x-icon">

  <!-- google analitycs -->
  <script>
    (function (i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function () {
        (i[r].q = i[r].q || []).push(arguments)
      }, i[r].l = 1 * new Date();
      a = s.createElement(o),
        m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
    ga('create', 'Your ID', 'auto');
    ga('send', 'pageview');
  </script>

</head>
<body><!-- navigation -->
<header class="navigation sticky"> 
  <div class="container">
    
    <nav class="navbar navbar-expand-lg navbar-white bg-transparent border-bottom pl-0">
      <a class="navbar-brand mobile-view" href="https://ho291ey992.github.io/"><img class="img-fluid"
          src="https://ho291ey992.github.io/images/favicon1.png" alt="學習筆記"></a>
      <button class="navbar-toggler border-0" type="button" data-toggle="collapse" data-target="#navigation">
        <i class="ti-menu"></i>
      </button>

      <div class="collapse navbar-collapse text-center" id="navigation">
        
        
        
        <a class="navbar-brand mx-auto desktop-view" href="https://ho291ey992.github.io/"><img class="img-fluid"
          src="https://ho291ey992.github.io/images/favicon1.png" alt="學習筆記">
        </a>

        <ul class="navbar-nav">
          
          
          <li class="nav-item">
            <a class="nav-link" href="https://ho291ey992.github.io/about/">About</a>
          </li>
          
          
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              筆記
            </a>
            <div class="dropdown-menu">
              
              <a class="dropdown-item" href="https://ho291ey992.github.io/note/hugo">hugo 網站建置</a>
              
              <a class="dropdown-item" href="https://ho291ey992.github.io/note/data_analysis">數據分析</a>
              
            </div>
          </li>
          
          
        </ul>

        
        <!-- search -->
        <div class="search pl-lg-4">
          <button id="searchOpen" class="search-btn"><i class="ti-search"></i></button>
          <div class="search-wrapper">
            <form action="https://ho291ey992.github.io//search" class="h-100">
              <input class="search-box px-4" id="search-query" name="s" type="search" placeholder="Type & Hit Enter...">
            </form>
            <button id="searchClose" class="search-close"><i class="ti-close text-dark"></i></button>
          </div>
        </div>
        

        
      </div>
    </nav>
  </div>
</header>
<!-- /navigation -->

<section class="section-sm">
  <div class="container">
    <div class="row">
      <div class="col-lg-10 mx-auto">
        
        <a href="/categories/data-analysis"
          class="text-primary">Data analysis</a>
        
        <h2>練習專案五：大疫世代 3</h2>  
        <div class="mb-3 post-meta">
          <span>By Steve</span>
          
          <span class="border-bottom border-primary px-2 mx-1"></span>
          <span>2025-09-29</span> 
          
        </div>
        
        <div class="content mb-5">
          <br>
<h3 id="數據可視化data-visualization">數據可視化（Data Visualization）</h3>
<h4 id="概念驗證proof-of-concept">概念驗證（Proof of Concept）</h4>
<p>完整程式碼：<a href="https://github.com/ho291ey992/covid_19_pandemic/blob/fbcc6c928e88e4248fd1c81e0ceb95aa79f59753/proof_of_concept_map_line.py">proof_of_concept_map_line.py</a></p>
<ul>
<li>
<p><strong>世界地圖</strong>：
本次課程上使用 <code>Scattermapbox</code> 但即將淘汰，所以修改成建議的 <code>Scattermap</code> 取代。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>fig <span style="color:#ff79c6">=</span> go<span style="color:#ff79c6">.</span>Figure(
</span></span><span style="display:flex;"><span>    go<span style="color:#ff79c6">.</span>Scattermap(
</span></span><span style="display:flex;"><span>        lat<span style="color:#ff79c6">=</span>daily_report[<span style="color:#f1fa8c">&#34;latitude&#34;</span>],
</span></span><span style="display:flex;"><span>        lon<span style="color:#ff79c6">=</span>daily_report[<span style="color:#f1fa8c">&#34;longitude&#34;</span>],
</span></span><span style="display:flex;"><span>        mode<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;markers&#34;</span>,
</span></span><span style="display:flex;"><span>        marker<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(
</span></span><span style="display:flex;"><span>            size<span style="color:#ff79c6">=</span>daily_report[<span style="color:#f1fa8c">&#34;confirmed&#34;</span>],
</span></span><span style="display:flex;"><span>            color<span style="color:#ff79c6">=</span>daily_report[<span style="color:#f1fa8c">&#34;confirmed&#34;</span>],
</span></span><span style="display:flex;"><span>            sizemin<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>,
</span></span><span style="display:flex;"><span>            sizeref<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">max</span>(daily_report[<span style="color:#f1fa8c">&#34;confirmed&#34;</span>]<span style="color:#ff79c6">.</span>max(), <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">2500</span>, <span style="color:#6272a4"># 調整氣泡大小比例尺</span>
</span></span><span style="display:flex;"><span>            sizemode<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;area&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>fig<span style="color:#ff79c6">.</span>update_layout(
</span></span><span style="display:flex;"><span>                <span style="color:#8be9fd;font-style:italic">map</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(
</span></span><span style="display:flex;"><span>                        style<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;open-street-map&#34;</span>,
</span></span><span style="display:flex;"><span>                        center<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(lat<span style="color:#ff79c6">=</span><span style="color:#bd93f9">23.7</span>, lon<span style="color:#ff79c6">=</span><span style="color:#bd93f9">121</span>),  <span style="color:#6272a4"># 地圖中心</span>
</span></span><span style="display:flex;"><span>                        zoom<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>                           <span style="color:#6272a4"># 初始化地圖大小，越小放越大（0=整個地球）</span>
</span></span><span style="display:flex;"><span>                    ),
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># 佈置到 Gradio 中</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Blocks() <span style="color:#ff79c6">as</span> demo:
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>Markdown(<span style="color:#f1fa8c">&#34;&#34;&#34;# Covid 19 Global Map&#34;&#34;&#34;</span>) <span style="color:#6272a4"># 網頁名稱，沒有想是使用 Markdown 來顯示。</span>
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>Plot(fig)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>demo<span style="color:#ff79c6">.</span>launch()
</span></span></code></pre></div><blockquote>
<p>提示訊息：DeprecationWarning: <em>scattermapbox</em> is deprecated! Use <em>scattermap</em> instead. Learn more at: <a href="https://plotly.com/python/mapbox-to-maplibre/">https://plotly.com/python/mapbox-to-maplibre/</a></p>
</blockquote>
<img src ='/images/note/data_analysis/project_5/map_proof_of_concept.png'>
</li>
<li>
<p><strong>折線圖</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>time_series[<span style="color:#f1fa8c">&#34;reported_on&#34;</span>] <span style="color:#ff79c6">=</span> pd<span style="color:#ff79c6">.</span>to_datetime(time_series[<span style="color:#f1fa8c">&#34;reported_on&#34;</span>])
</span></span><span style="display:flex;"><span>time_series <span style="color:#ff79c6">=</span> time_series[time_series[<span style="color:#f1fa8c">&#39;country&#39;</span>] <span style="color:#ff79c6">==</span> <span style="color:#f1fa8c">&#39;Taiwan*&#39;</span>] <span style="color:#6272a4"># 抓取台灣資料</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Blocks() <span style="color:#ff79c6">as</span> demo:
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>Markdown(<span style="color:#f1fa8c">&#34;&#34;&#34;# Covid 19 Country Time Series&#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>LinePlot(time_series, x<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reported_on&#34;</span>, y<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;confirmed&#34;</span>)
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>LinePlot(time_series, x<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reported_on&#34;</span>, y<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;deaths&#34;</span>)
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>LinePlot(time_series, x<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reported_on&#34;</span>, y<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;doses_administered&#34;</span>)
</span></span><span style="display:flex;"><span>demo<span style="color:#ff79c6">.</span>launch()
</span></span></code></pre></div><img src ='/images/note/data_analysis/project_5/line_proof_of_concept.png'>
</li>
</ul>
<br>
<hr>
<h3 id="可視化成品final-visualization">可視化成品（Final Visualization）</h3>
<p>採用 <code>Gradio</code> 展示成品，使用 <code>gr.TabbedInterface</code> 結合世界地圖與折線圖。<br></p>
<ul>
<li>成品參考：<a href="https://huggingface.co/spaces/ho291ey992/covid_19_pandemic">Huggingface</a>。</li>
<li>完整程式碼：<a href="https://huggingface.co/spaces/ho291ey992/covid_19_pandemic/blob/main/app.py">app.py</a></li>
</ul>
<br>
<h5 id="每日統計資料---地圖氣泡圖">每日統計資料 - 地圖氣泡圖</h5>
<ul>
<li>
<p><strong>地圖頁面</strong>：新增細節<strong>確診數、死亡數、疫苗數統計資料</strong>、<strong>篩選清單</strong>(預設為確診數前 30 國家) 與 <strong>更新按鈕</strong>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#6272a4"># 氣泡資訊</span>
</span></span><span style="display:flex;"><span>self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#34;information_when_hovered&#34;</span>] <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report<span style="color:#ff79c6">.</span>apply(<span style="color:#ff79c6">lambda</span> x:self<span style="color:#ff79c6">.</span>format_hover_row(x), axis<span style="color:#ff79c6">=</span><span style="color:#bd93f9">1</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Blocks() <span style="color:#ff79c6">as</span> global_map_tab:
</span></span><span style="display:flex;"><span>    gr<span style="color:#ff79c6">.</span>Markdown(<span style="color:#f1fa8c">&#34;&#34;&#34;# Covid 19 Global Map&#34;&#34;&#34;</span>) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 新增：確診數、死亡數、疫苗數累積統計資料</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Row():
</span></span><span style="display:flex;"><span>        gr<span style="color:#ff79c6">.</span>Label(value<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>total_confirmed<span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">,</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>, label<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Total cases&#34;</span>)
</span></span><span style="display:flex;"><span>        gr<span style="color:#ff79c6">.</span>Label(value<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>total_deaths<span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">,</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>, label<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Total deaths&#34;</span>)
</span></span><span style="display:flex;"><span>        gr<span style="color:#ff79c6">.</span>Label(value<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>total_doses_administered<span style="color:#f1fa8c">:</span><span style="color:#f1fa8c">,</span><span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>, label<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Total doses administered&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 新增：各國篩選清單下拉選單</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Column():
</span></span><span style="display:flex;"><span>        countries <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>Dropdown(choices<span style="color:#ff79c6">=</span>self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#34;country&#34;</span>]<span style="color:#ff79c6">.</span>drop_duplicates()<span style="color:#ff79c6">.</span>tolist(),
</span></span><span style="display:flex;"><span>                                label<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Select countries:&#34;</span>,
</span></span><span style="display:flex;"><span>                                multiselect<span style="color:#ff79c6">=</span><span style="color:#ff79c6">True</span>, <span style="color:#6272a4"># 開啟複選</span>
</span></span><span style="display:flex;"><span>                                value<span style="color:#ff79c6">=</span>top_confirmed) <span style="color:#6272a4"># 預設資料</span>
</span></span><span style="display:flex;"><span>        btn <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>Button(value<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Update&#34;</span>) <span style="color:#6272a4"># 更新按鈕</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 建立地圖框</span>
</span></span><span style="display:flex;"><span>    global_map <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>Plot()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 預設資料</span>
</span></span><span style="display:flex;"><span>    global_map_tab<span style="color:#ff79c6">.</span>load(fn<span style="color:#ff79c6">=</span>self<span style="color:#ff79c6">.</span>filter_global_map,
</span></span><span style="display:flex;"><span>                        inputs<span style="color:#ff79c6">=</span>countries,
</span></span><span style="display:flex;"><span>                        outputs<span style="color:#ff79c6">=</span>global_map)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 按鈕:更新資料</span>
</span></span><span style="display:flex;"><span>    btn<span style="color:#ff79c6">.</span>click(fn<span style="color:#ff79c6">=</span>self<span style="color:#ff79c6">.</span>filter_global_map,
</span></span><span style="display:flex;"><span>              inputs<span style="color:#ff79c6">=</span>countries,
</span></span><span style="display:flex;"><span>              outputs<span style="color:#ff79c6">=</span>global_map)
</span></span></code></pre></div><br>
</li>
<li>
<p><strong>地圖繪製</strong>：新增 <strong>氣泡資訊</strong>。調整 <strong>地圖邊界寬度</strong>。由於建立篩選功能，需要重新繪製地圖，所以須單獨建立函數，方便資料更新。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#6272a4"># 地圖繪製</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">filter_global_map</span>(self, country_names):
</span></span><span style="display:flex;"><span>    filtered_daily_report <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#34;country&#34;</span>]<span style="color:#ff79c6">.</span>isin(country_names)]
</span></span><span style="display:flex;"><span>    fig <span style="color:#ff79c6">=</span> go<span style="color:#ff79c6">.</span>Figure(
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># Scattermapbox 即將淘汰，使用 Scattermap 取代。</span>
</span></span><span style="display:flex;"><span>        go<span style="color:#ff79c6">.</span>Scattermap(
</span></span><span style="display:flex;"><span>            lat<span style="color:#ff79c6">=</span>filtered_daily_report[<span style="color:#f1fa8c">&#34;latitude&#34;</span>],
</span></span><span style="display:flex;"><span>            lon<span style="color:#ff79c6">=</span>filtered_daily_report[<span style="color:#f1fa8c">&#34;longitude&#34;</span>],
</span></span><span style="display:flex;"><span>            customdata<span style="color:#ff79c6">=</span>filtered_daily_report[<span style="color:#f1fa8c">&#39;information_when_hovered&#39;</span>], <span style="color:#6272a4"># 氣泡資訊</span>
</span></span><span style="display:flex;"><span>            hovertemplate<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;%</span><span style="color:#f1fa8c">{customdata}</span><span style="color:#f1fa8c">&#34;</span>, <span style="color:#6272a4"># 文字樣式</span>
</span></span><span style="display:flex;"><span>            mode<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;markers&#34;</span>,
</span></span><span style="display:flex;"><span>            marker<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(
</span></span><span style="display:flex;"><span>                size<span style="color:#ff79c6">=</span>filtered_daily_report[<span style="color:#f1fa8c">&#34;confirmed&#34;</span>],
</span></span><span style="display:flex;"><span>                color<span style="color:#ff79c6">=</span>filtered_daily_report[<span style="color:#f1fa8c">&#34;confirmed&#34;</span>],
</span></span><span style="display:flex;"><span>                sizemin<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>,
</span></span><span style="display:flex;"><span>                sizeref<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">max</span>(filtered_daily_report[<span style="color:#f1fa8c">&#34;confirmed&#34;</span>]<span style="color:#ff79c6">.</span>max(), <span style="color:#bd93f9">1</span>) <span style="color:#ff79c6">/</span> <span style="color:#bd93f9">2500</span>,
</span></span><span style="display:flex;"><span>                sizemode<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;area&#34;</span>
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    fig<span style="color:#ff79c6">.</span>update_layout(
</span></span><span style="display:flex;"><span>                    margin<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(l<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>, r<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>, t<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>, b<span style="color:#ff79c6">=</span><span style="color:#bd93f9">10</span>), <span style="color:#6272a4"># 調整地圖邊界寬度</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#8be9fd;font-style:italic">map</span><span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(
</span></span><span style="display:flex;"><span>                            style<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;open-street-map&#34;</span>,
</span></span><span style="display:flex;"><span>                            center<span style="color:#ff79c6">=</span><span style="color:#8be9fd;font-style:italic">dict</span>(lat<span style="color:#ff79c6">=</span><span style="color:#bd93f9">23.7</span>, lon<span style="color:#ff79c6">=</span><span style="color:#bd93f9">121</span>),  <span style="color:#6272a4"># 地圖中心</span>
</span></span><span style="display:flex;"><span>                            zoom<span style="color:#ff79c6">=</span><span style="color:#bd93f9">2</span>                           <span style="color:#6272a4"># 初始化地圖大小，越小放越大（0=整個地球）</span>
</span></span><span style="display:flex;"><span>                        ),
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> fig
</span></span></code></pre></div><br>
</li>
<li>
<p><strong>氣泡資訊處理</strong>：這邊使用 <code>apply</code> 逐筆資料處理，但若資料規模超過十萬或百萬時，建議採用向量方式處理。</p>
<ul>
<li>apply逐筆資料處理
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">format_hover_row</span>(self, df):
</span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">建立地圖 hover 提示字串。
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">根據資料粒度決定不同格式：
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">- county 有值 → 顯示 (country, province, county)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">- province 有值 → 顯示 (country, province)
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">- 只剩 country → 顯示 country
</span></span></span><span style="display:flex;"><span><span style="color:#f1fa8c">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">if</span> df<span style="color:#ff79c6">.</span>county <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span>    col <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;(</span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>country<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">, </span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>province<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">, </span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>county<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">elif</span> df[<span style="color:#f1fa8c">&#34;province&#34;</span>] <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">None</span>:
</span></span><span style="display:flex;"><span>    col <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;(</span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>country<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">, </span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>province<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">)&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">else</span> :
</span></span><span style="display:flex;"><span>    col <span style="color:#ff79c6">=</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;</span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>country<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">return</span> <span style="color:#f1fa8c">f</span><span style="color:#f1fa8c">&#34;Location: </span><span style="color:#f1fa8c">{</span>col<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&lt;br&gt;Confirmed: </span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>confirmed<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&lt;br&gt;Deaths: </span><span style="color:#f1fa8c">{</span>df<span style="color:#ff79c6">.</span>deaths<span style="color:#f1fa8c">}</span><span style="color:#f1fa8c">&#34;</span>
</span></span></code></pre></div></li>
</ul>
<br>
<ul>
<li>練習向量處理資料
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#6272a4"># 資料處理 - 氣泡圖 hoverinfo。</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">information_when_hovered_df</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 使用向量方法資料</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4"># 觀察 daily_report 資料後發現，1. country必定有資料、2. province有資料時，county不一定有資料、3. </span>
</span></span><span style="display:flex;"><span>    mask_county <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#39;county&#39;</span>]<span style="color:#ff79c6">.</span>notna()
</span></span><span style="display:flex;"><span>    mask_province <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#39;province&#39;</span>]<span style="color:#ff79c6">.</span>notna() <span style="color:#ff79c6">&amp;</span> self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#39;county&#39;</span>]<span style="color:#ff79c6">.</span>isna()
</span></span><span style="display:flex;"><span>    mask_country <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#39;province&#39;</span>]<span style="color:#ff79c6">.</span>isna() <span style="color:#ff79c6">&amp;</span> self<span style="color:#ff79c6">.</span>daily_report[<span style="color:#f1fa8c">&#39;county&#39;</span>]<span style="color:#ff79c6">.</span>isna()
</span></span><span style="display:flex;"><span>    county_df <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[mask_county]<span style="color:#ff79c6">.</span>copy()<span style="color:#ff79c6">.</span>astype(<span style="color:#8be9fd;font-style:italic">str</span>)
</span></span><span style="display:flex;"><span>    province_df <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[mask_province]<span style="color:#ff79c6">.</span>copy()<span style="color:#ff79c6">.</span>astype(<span style="color:#8be9fd;font-style:italic">str</span>)
</span></span><span style="display:flex;"><span>    country_df <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>daily_report[mask_country]<span style="color:#ff79c6">.</span>copy()<span style="color:#ff79c6">.</span>astype(<span style="color:#8be9fd;font-style:italic">str</span>)
</span></span><span style="display:flex;"><span>    s_county <span style="color:#ff79c6">=</span> (<span style="color:#f1fa8c">&#34;Location: (&#34;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> county_df[<span style="color:#f1fa8c">&#39;country&#39;</span>]<span style="color:#ff79c6">.</span>str<span style="color:#ff79c6">.</span>cat(county_df[[<span style="color:#f1fa8c">&#39;province&#39;</span>, <span style="color:#f1fa8c">&#39;county&#39;</span>]], sep<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;, &#39;</span>) 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;)&lt;br&gt;Confirmed: &#34;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> county_df[<span style="color:#f1fa8c">&#39;confirmed&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&lt;br&gt;Deaths: &#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> county_df[<span style="color:#f1fa8c">&#39;deaths&#39;</span>])<span style="color:#ff79c6">.</span>reindex(self<span style="color:#ff79c6">.</span>daily_report<span style="color:#ff79c6">.</span>index)
</span></span><span style="display:flex;"><span>    s_province <span style="color:#ff79c6">=</span> (<span style="color:#f1fa8c">&#34;Location: (&#34;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> province_df[<span style="color:#f1fa8c">&#39;country&#39;</span>]<span style="color:#ff79c6">.</span>str<span style="color:#ff79c6">.</span>cat(province_df[<span style="color:#f1fa8c">&#39;province&#39;</span>], sep<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#39;, &#39;</span>) 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;)&lt;br&gt;Confirmed: &#34;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> province_df[<span style="color:#f1fa8c">&#39;confirmed&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&lt;br&gt;Deaths: &#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> province_df[<span style="color:#f1fa8c">&#39;deaths&#39;</span>])<span style="color:#ff79c6">.</span>reindex(self<span style="color:#ff79c6">.</span>daily_report<span style="color:#ff79c6">.</span>index)
</span></span><span style="display:flex;"><span>    s_country <span style="color:#ff79c6">=</span> (<span style="color:#f1fa8c">&#39;Location: &#39;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> country_df[<span style="color:#f1fa8c">&#39;country&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;&lt;br&gt;Confirmed: &#34;</span> 
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> country_df[<span style="color:#f1fa8c">&#39;confirmed&#39;</span>]
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#39;&lt;br&gt;Deaths: &#39;</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">+</span> country_df[<span style="color:#f1fa8c">&#39;deaths&#39;</span>])<span style="color:#ff79c6">.</span>reindex(self<span style="color:#ff79c6">.</span>daily_report<span style="color:#ff79c6">.</span>index)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> np<span style="color:#ff79c6">.</span>select([mask_county, mask_province, mask_country],[s_county, s_province, s_country])
</span></span></code></pre></div></li>
</ul>
<br>
</li>
<li>
<p>成品展示
<img src ='/images/note/data_analysis/project_5/map_finished_product.png'></p>
</li>
</ul>
<hr>
<h5 id="各國時間序列資料---折線圖">各國時間序列資料 - 折線圖</h5>
<p>新增 <strong>下拉選單</strong>，這邊有一個新的概念 <strong>裝飾器（decorator）</strong>。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:2;-o-tab-size:2;tab-size:2;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">country_time_series_page</span>(self):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Blocks() <span style="color:#ff79c6">as</span> country_time_series_tab:
</span></span><span style="display:flex;"><span>        gr<span style="color:#ff79c6">.</span>Markdown(<span style="color:#f1fa8c">&#34;&#34;&#34;# Covid 19 Country Time Series&#34;&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 新增：下拉選單</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">with</span> gr<span style="color:#ff79c6">.</span>Row():
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            country <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>Dropdown(choices<span style="color:#ff79c6">=</span>self<span style="color:#ff79c6">.</span>time_series[<span style="color:#f1fa8c">&#34;country&#34;</span>]<span style="color:#ff79c6">.</span>unique()<span style="color:#ff79c6">.</span>tolist(),
</span></span><span style="display:flex;"><span>                        label<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Select countries:&#34;</span>,
</span></span><span style="display:flex;"><span>                        value<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;Taiwan*&#34;</span>)
</span></span><span style="display:flex;"><span>        total_confimed <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>LinePlot(self<span style="color:#ff79c6">.</span>time_series<span style="color:#ff79c6">.</span>head(), x<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reported_on&#34;</span>, y<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;confirmed&#34;</span>)
</span></span><span style="display:flex;"><span>        total_deaths <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>LinePlot(self<span style="color:#ff79c6">.</span>time_series<span style="color:#ff79c6">.</span>head(), x<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reported_on&#34;</span>, y<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;deaths&#34;</span>)
</span></span><span style="display:flex;"><span>        total_doses_administered <span style="color:#ff79c6">=</span> gr<span style="color:#ff79c6">.</span>LinePlot(self<span style="color:#ff79c6">.</span>time_series<span style="color:#ff79c6">.</span>head(), x<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;reported_on&#34;</span>, y<span style="color:#ff79c6">=</span><span style="color:#f1fa8c">&#34;doses_administered&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 監聽使用者互動事件（切換 Dropdown 時）。 </span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 在 5.x 新版 Gradio 元件會初始值 (value) 直接觸發綁定的函數（@gr.on），第一次載入頁面會自動觸發 @gr.on，所以即使沒有 country_time_series_tab.load 折線圖也能正常顯示。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4"># 裝飾器： @gr.on 是個 decorator，它會把「下面定義的函數」自動註冊到這些 input/output 元件上。</span>
</span></span><span style="display:flex;"><span>        @gr.on(inputs<span style="color:#ff79c6">=</span>country, outputs<span style="color:#ff79c6">=</span>total_confimed)
</span></span><span style="display:flex;"><span>        @gr.on(inputs<span style="color:#ff79c6">=</span>country, outputs<span style="color:#ff79c6">=</span>total_deaths)
</span></span><span style="display:flex;"><span>        @gr.on(inputs<span style="color:#ff79c6">=</span>country, outputs<span style="color:#ff79c6">=</span>total_doses_administered)
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">def</span> <span style="color:#50fa7b">filter_country</span>(country):
</span></span><span style="display:flex;"><span>            select_country_df <span style="color:#ff79c6">=</span> self<span style="color:#ff79c6">.</span>time_series[self<span style="color:#ff79c6">.</span>time_series[<span style="color:#f1fa8c">&#34;country&#34;</span>] <span style="color:#ff79c6">==</span> country]
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> select_country_df
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">print</span>(<span style="color:#f1fa8c">&#34;country_time_series_page pass&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> country_time_series_tab
</span></span></code></pre></div><br>
<ul>
<li>成品展示
<img src ='/images/note/data_analysis/project_5/line_finished_product.png'></li>
</ul>
<br>
<hr>
<p><a href="https://ho291ey992.github.io/note/data_analysis/project_5_2/">上一章</a></p>
<p><a href="https://ho291ey992.github.io/note/data_analysis/project_5_4/">下一章</a></p>

        </div>

        
        
      </div>
    </div>
  </div>
</section>





<script>
  var indexURL = "https://ho291ey992.github.io/index.json"
</script>

<!-- JS Plugins -->

<script src="https://ho291ey992.github.io/plugins/jQuery/jquery.min.js"></script>

<script src="https://ho291ey992.github.io/plugins/bootstrap/bootstrap.min.js"></script>

<script src="https://ho291ey992.github.io/plugins/slick/slick.min.js"></script>

<script src="https://ho291ey992.github.io/plugins/venobox/venobox.min.js"></script>

<script src="https://ho291ey992.github.io/plugins/search/fuse.min.js"></script>

<script src="https://ho291ey992.github.io/plugins/search/mark.js"></script>

<script src="https://ho291ey992.github.io/plugins/search/search.js"></script>

<!-- Main Script -->

<script src="https://ho291ey992.github.io/js/script.min.js"></script>



</body>
</html>